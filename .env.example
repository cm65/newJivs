# JiVS Platform Environment Variables Configuration
# Copy this file to .env and update with your actual values

# ============================================
# Application Profile
# ============================================
SPRING_PROFILE=prod

# ============================================
# Server Configuration
# ============================================
SERVER_PORT=8080

# ============================================
# Database Configuration (PostgreSQL)
# ============================================
DATABASE_URL=jdbc:postgresql://localhost:5432/jivs
DATABASE_USERNAME=jivs
DATABASE_PASSWORD=change_me_in_production

# Database Connection Pool (HikariCP) - Updated for P0.5 Performance Optimization
# Maximum pool size increased from 20 to 50 for high concurrency extraction workloads
HIKARI_MAXIMUM_POOL_SIZE=50
HIKARI_MINIMUM_IDLE=10
HIKARI_CONNECTION_TIMEOUT=5000
HIKARI_VALIDATION_TIMEOUT=3000
HIKARI_IDLE_TIMEOUT=300000
HIKARI_MAX_LIFETIME=900000
HIKARI_LEAK_DETECTION_THRESHOLD=60000

# ============================================
# Redis Cache Configuration
# ============================================
REDIS_HOST=localhost
REDIS_PORT=6379
REDIS_PASSWORD=

# Redis Cache Settings - Updated for P0.3 Performance Optimization
# Increased memory limit from 512MB to 2GB to support extraction caching
REDIS_MAXMEMORY=2gb
REDIS_MAXMEMORY_POLICY=allkeys-lru

# Cache TTL Configuration (milliseconds)
CACHE_TTL_DATASOURCES=3600000       # 1 hour
CACHE_TTL_EXTRACTION_CONFIGS=1800000 # 30 minutes
CACHE_TTL_EXTRACTION_STATS=300000   # 5 minutes

# ============================================
# Elasticsearch Configuration
# ============================================
ELASTICSEARCH_URIS=http://localhost:9201
ELASTICSEARCH_USERNAME=
ELASTICSEARCH_PASSWORD=

# ============================================
# RabbitMQ Configuration
# ============================================
RABBITMQ_HOST=localhost
RABBITMQ_PORT=5672
RABBITMQ_USERNAME=jivs
RABBITMQ_PASSWORD=change_me_in_production

# ============================================
# Security Configuration
# ============================================
JWT_SECRET=change-this-secret-key-in-production-minimum-256-bits
JWT_EXPIRATION=86400000              # 24 hours
JWT_REFRESH_EXPIRATION=604800000    # 7 days

ENCRYPTION_KEY=change-this-encryption-key-in-production
ENCRYPTION_ALGORITHM=AES/GCM/NoPadding
ENCRYPTION_KEY_SIZE=256

# CORS Configuration
CORS_ALLOWED_ORIGINS=http://localhost:3000,http://localhost:3001,http://localhost:5173
CORS_ALLOWED_METHODS=GET,POST,PUT,DELETE,PATCH,OPTIONS
CORS_ALLOWED_HEADERS=*
CORS_ALLOW_CREDENTIALS=true
CORS_MAX_AGE=3600

# ============================================
# Storage Configuration
# ============================================
STORAGE_PROVIDER=local               # Options: local, s3, azure, gcp
STORAGE_LOCAL_PATH=/var/jivs/storage

# AWS S3 Configuration
AWS_S3_BUCKET=
AWS_REGION=us-east-1
AWS_ACCESS_KEY=
AWS_SECRET_KEY=

# Azure Blob Storage Configuration
AZURE_STORAGE_ACCOUNT=
AZURE_STORAGE_KEY=
AZURE_CONTAINER=jivs

# Google Cloud Storage Configuration
GCP_PROJECT_ID=
GCP_BUCKET=
GCP_CREDENTIALS_PATH=

# ============================================
# Extraction Performance Configuration (P0 Optimizations)
# ============================================

# Maximum parallel extraction jobs (increased from 5 to 10)
EXTRACTION_MAX_PARALLEL_JOBS=10

# Batch processing settings - P0.1 Optimization
# Reduced from 10000 to 1000 to reduce memory footprint
EXTRACTION_BATCH_SIZE=1000

# ResultSet fetch size for streaming
EXTRACTION_FETCH_SIZE=1000

# Parallel threads per extraction job
EXTRACTION_PARALLEL_THREADS=4

# Temporary directory for extraction processing
EXTRACTION_TEMP_DIRECTORY=/tmp/jivs/extraction

# Connection Pool Per Data Source - P0.2 Optimization
# Each extraction source gets its own HikariCP connection pool
EXTRACTION_SOURCE_POOL_MAX_SIZE=10
EXTRACTION_SOURCE_POOL_MIN_IDLE=2
EXTRACTION_SOURCE_POOL_TIMEOUT=5000

# ============================================
# Migration Configuration
# ============================================
MIGRATION_MAX_PARALLEL_JOBS=3
MIGRATION_CHECKPOINT_INTERVAL=1000

# ============================================
# Data Quality Configuration
# ============================================
DATA_QUALITY_DUPLICATE_THRESHOLD=0.95
DATA_QUALITY_VALIDATION_RULES_PATH=/etc/jivs/validation-rules

# ============================================
# Compliance Configuration
# ============================================
# GDPR Configuration
GDPR_ENABLED=true
GDPR_DEFAULT_RETENTION_DAYS=2555    # 7 years

# CCPA Configuration
CCPA_ENABLED=true

# ============================================
# Audit Configuration
# ============================================
AUDIT_ENABLED=true
AUDIT_RETENTION_DAYS=2555            # 7 years

# ============================================
# Document Processing Configuration
# ============================================
DOCUMENT_SUPPORTED_FORMATS=pdf,doc,docx,xls,xlsx,ppt,pptx,txt,xml,json
DOCUMENT_MAX_FILE_SIZE=104857600     # 100MB
DOCUMENT_OCR_ENABLED=false

# ============================================
# Monitoring & Metrics Configuration
# ============================================
MONITORING_METRICS_ENABLED=true
MONITORING_HEALTH_CHECK_INTERVAL=60000

# JMX Configuration for Connection Pool Monitoring
JMX_ENABLED=true
JMX_PORT=9010
JMX_AUTHENTICATE=false
JMX_SSL=false

# ============================================
# JVM Configuration
# ============================================
# Optimized for extraction performance with increased heap and G1GC
JAVA_OPTS=-Xms2g -Xmx4g -XX:+UseG1GC -XX:MaxGCPauseMillis=200 -XX:+HeapDumpOnOutOfMemoryError -XX:HeapDumpPath=/app/logs/heapdump.hprof

# ============================================
# Logging Configuration
# ============================================
LOG_LEVEL_ROOT=INFO
LOG_LEVEL_JIVS=DEBUG
LOG_LEVEL_SPRING_WEB=INFO
LOG_LEVEL_SPRING_SECURITY=DEBUG
LOG_LEVEL_HIBERNATE_SQL=DEBUG

LOG_FILE_NAME=logs/jivs-platform.log
LOG_FILE_MAX_SIZE=10MB
LOG_FILE_MAX_HISTORY=30

# ============================================
# Retention Management Configuration
# ============================================
RETENTION_SCAN_INTERVAL=86400000     # 24 hours
RETENTION_BATCH_SIZE=1000

# ============================================
# Camunda BPM Configuration
# ============================================
CAMUNDA_ADMIN_PASSWORD=change_me_in_production

# ============================================
# Additional Notes
# ============================================
#
# Performance Optimization Summary (P0 Changes):
#
# 1. HikariCP Main Pool: Increased from 20 to 50 connections
#    - Supports higher concurrent extraction workloads
#    - Reduced connection timeout from 30s to 5s for faster failure detection
#
# 2. Redis Cache: Increased from 512MB to 2GB
#    - Supports caching of DataSource configurations (1 hour TTL)
#    - Supports caching of extraction statistics (5 minute TTL)
#    - LRU eviction policy for automatic memory management
#
# 3. Extraction Optimization:
#    - Batch processing with 1000 records per batch (reduced from 10000)
#    - 4 parallel threads per extraction job
#    - Dedicated connection pool per data source (10 connections each)
#    - Fetch size optimization for ResultSet streaming
#
# 4. JVM Tuning:
#    - Increased heap from 2GB max to 4GB max
#    - G1GC with 200ms max pause time target
#    - JMX monitoring enabled for connection pool metrics
#
# Expected Performance Improvements:
# - Throughput: 2x improvement (10k → 20k records/min)
# - API Latency (p95): 56% reduction (450ms → 200ms)
# - Cache Hit Rate Target: 70%+
# - Connection Pool Utilization Target: 80-90%
